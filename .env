#!/usr/bin/env bash
# Shared environment for agent launcher scripts.
# OLLAMA_HOST is the client-side NodePort URL used by host tools to reach Ollama.
# It does not match the ConfigMap bind address (0.0.0.0:11434) which is server-side.
# Use localhost:31434 when running on the cluster node, bigfish:31434 from other machines.
# Override any variable before sourcing or via environment.

OLLAMA_HOST="${OLLAMA_HOST:-http://bigfish:31434}"
OLLAMA_URL="${OLLAMA_URL:-$OLLAMA_HOST}"

# Base model pulled from Ollama registry
AGENT_BASE_MODEL="${AGENT_BASE_MODEL:-qwen3:14b}"

# Default tuned alias created by the Ollama postStart hook with baked-in verbosity controls.
AGENT_MODEL="${AGENT_MODEL:-${AGENT_BASE_MODEL}-agent}"

# Per-frontend model overrides. Set any of these to use a different model for that frontend.
AIDER_MODEL="${AIDER_MODEL:-llama3.1:8b}"
GOOSE_MODEL="${GOOSE_MODEL:-${AGENT_MODEL}}"
OLLMCP_MODEL="${OLLMCP_MODEL:-mistral-nemo:latest}"
OPENCODE_MODEL="${OPENCODE_MODEL:-${AGENT_BASE_MODEL}-16k}"
OPENHANDS_MODEL="${OPENHANDS_MODEL:-mistral-nemo:latest}"

# Response tuning parameters. Same defaults as the ConfigMap.
AGENT_TEMPERATURE="${AGENT_TEMPERATURE:-0.7}"
AGENT_MAX_TOKENS="${AGENT_MAX_TOKENS:-2048}"
AGENT_TOP_P="${AGENT_TOP_P:-0.9}"
AGENT_REPEAT_PENALTY="${AGENT_REPEAT_PENALTY:-1.2}"
AGENT_SYSTEM_PROMPT="${AGENT_SYSTEM_PROMPT:-Be concise and direct. Avoid filler phrases. When helping with code, ALWAYS search the web for latest documentation, API references, and code examples before answering. Do not rely on potentially outdated training data for libraries, frameworks, or technical specifications. Search first, then answer.}"

# Multi-agent system models
INTERPRETER_MODEL="${INTERPRETER_MODEL:-qwen2.5:7b}"
ORCHESTRATOR_MODEL="${ORCHESTRATOR_MODEL:-${AGENT_MODEL}}"
RESEARCH_MODEL="${RESEARCH_MODEL:-qwen2.5:7b}"
SYNTHESIS_MODEL="${SYNTHESIS_MODEL:-${AGENT_MODEL}}"
CRITIC_MODEL="${CRITIC_MODEL:-qwen2.5:7b}"

# RAG configuration
QDRANT_URL="${QDRANT_URL:-http://bigfish:31333}"
EMBEDDING_MODEL="${EMBEDDING_MODEL:-nomic-embed-text}"
SEARXNG_URL="${SEARXNG_URL:-http://bigfish:31080}"
