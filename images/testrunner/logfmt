#!/usr/bin/env python3
"""Wrap stdin lines as JSON log entries for lnav compatibility."""
import sys
import json
from datetime import datetime, timezone

level = sys.argv[1] if len(sys.argv) > 1 else "info"

while True:
    line = sys.stdin.readline()
    if not line:
        break
    print(json.dumps({
        "timestamp": datetime.now(timezone.utc).strftime("%Y-%m-%dT%H:%M:%S.%f")[:-3] + "Z",
        "level": level,
        "msg": line.rstrip("\n"),
    }), flush=True)
